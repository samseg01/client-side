<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO Client</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <script>
        // Função para obter o endereço do WebSocket
        async function getSocketAddress() {
            console.log('aguarde...')
            try {
                const response = await fetch('https://api-websocket-production.up.railway.app/config');
                const data = await response.json();

                // Atualize a página com os dados obtidos
                await console.log(data)
                return await data.socketAddress;
            } catch (error) {
                console.error(`Erro na solicitação AJAX: ${error.message}`);
            }
        }
        // async function getLink(){
        //     let link = await getSocketAddress()
        //     console.log(link)
        // }
        // getLink()

        // Função para conectar-se ao servidor Socket.IO
        async function connectToSocketIO() {
            // const socketAddress = await getSocketAddress();
            // console.log(socketAddress)
            const socket = io('http://api-websocket-production.up.railway.app:7402/');

            // Manipula eventos de conexão e mensagens conforme necessário
            socket.on('connect', () => {
                console.log('Conectado ao servidor Socket.IO');
            });

            socket.on('disconnect', () => {
                console.log('Desconectado do servidor Socket.IO');
            });

            socket.on('message', (data) => {
                console.log('Mensagem recebida:', data);
            });

            // Função para enviar mensagem ao servidor
            function sendMessage() {
                const message = document.getElementById('messageInput').value;
                socket.emit('message', message);
            }
        }
        
        // Chama a função para conectar-se ao servidor Socket.IO quando a página é carregada
        window.onload = function() {
            connectToSocketIO();
        };
    </script>
</head>
<body>
    <input type="text" id="messageInput" placeholder="Digite sua mensagem">
    <button onclick="sendMessage()">Enviar Mensagem</button>
</body>
</html>
